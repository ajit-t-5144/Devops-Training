pipeline {
    
    agent any
    
    environment {
        buildnum = currentBuild.getNumber()
        
         dockerImagename = "ajit5144/devops-app-${buildnum}"
    }
    
    tools {
         groovy 'groovy'
         maven 'maven'
         jdk 'jdk'
    } //tools end 
    
    stages {
        stage('Code Checkout') {
            steps {
              git branch: 'main', url: 'https://github.com/ajit-t-5144/docker-war.git'
            }
        }//checkout stage end
        
        stage('echo build num'){
            steps{
                echo " Build number is ${buildnum}"
            }
        }//echo end

            
        }//generate end 
        
         stage(' Build Docker Image'){
            steps{ 
                 sh 'docker build -t ${dockerImagename} --pull=true /var/lib/jenkins/workspace/devops-training'
                 //echo "${dockerImagename}"
            } 
            
            
         }//Docker build done  
         stage(' Push to Docker Hub'){
            steps{ 
                withCredentials([string(credentialsId: 'docker-hub', variable: 'dockerhub')]) {
                    sh "docker login -u ajit5144 -p ${dockerhub}"
                 //echo "${dockerImagename}"
                }
                
                sh "docker push ${dockerImagename}"
                 
            }
       
        }//Docker Push done
        
        
        
    } //stages end
    
}//pipeline end
